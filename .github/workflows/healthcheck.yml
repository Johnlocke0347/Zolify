name: Miner Jobs Live
on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4

    - name: Build miner container
      run: docker build -t zolify-miner .

    - name: Run health check
      run: |
        docker run -d --name miner-check zolify-miner
        
        echo "Waiting 15s for miner startup..."
        sleep 15
        
        # Check if the process 'python' is running inside the container
        if docker exec miner-check pgrep -f "python" > /dev/null; then
          echo "SUCCESS: Miner process is running."
          docker stop miner-check
          exit 0
        else
          echo "FAILED: Miner process not found!"
          docker logs miner-check
          docker inspect miner-check
          exit 1
        fi
